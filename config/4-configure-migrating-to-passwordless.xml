<data xmlns="urn:ietf:params:xml:ns:yang:ietf-restconf">
  <profiles xmlns="https://curity.se/ns/conf/base">
    <profile>
      <id>authentication-service</id>
      <type xmlns:auth="https://curity.se/ns/conf/profile/authentication">auth:authentication-service</type>
      <settings>
        <authentication-service xmlns="https://curity.se/ns/conf/profile/authentication">
          <account-domains>
            <account-domain>
              <id>local-domain</id>
              <description>The domain that manages the main account record</description>
            </account-domain>
            <account-domain>
              <id>webauthn-domain</id>
              <description>A domain for linked webauthn devices</description>
            </account-domain>
          </account-domains>
          <authentication-actions>
            <authentication-action>
              <id>check-show-selector</id>
              <switch xmlns="https://curity.se/ns/ext-conf/switch">
                <case>
                  <name>webauthn</name>
                  <condition-script>YXR0cmlidXRlcy5hY3Rpb24ud2ViYXV0aG4gPT0gdHJ1ZQ==</condition-script>
                  <action>webauthn-condition</action>
                </case>
                <case>
                  <name>selector</name>
                  <condition-script>YXR0cmlidXRlcy5hY3Rpb24ud2ViYXV0aG4gPT0gZmFsc2U=</condition-script>
                  <action>selector-sequence</action>
                </case>
                <fail-if-no-match>true</fail-if-no-match>
              </switch>
            </authentication-action>
            <authentication-action>
              <id>debug</id>
              <debug-attribute xmlns="https://curity.se/ns/ext-conf/debug-attribute"/>
            </authentication-action>
            <authentication-action>
              <id>htmlform-condition</id>
              <multi-factor-condition xmlns="https://curity.se/ns/ext-conf/multi-factor-condition">
                <attribute-enable-condition>
                  <second-factor>
                    <id>htmlform</id>
                  </second-factor>
                  <attribute-name>htmlform</attribute-name>
                  <attribute-source>action-attributes</attribute-source>
                </attribute-enable-condition>
              </multi-factor-condition>
            </authentication-action>
            <authentication-action>
              <id>load_webauthn_devices</id>
              <data-source-transformer xmlns="https://curity.se/ns/ext-conf/data-source-transformer">
                <attribute-data-source>
                  <data-source>devices_datasource</data-source>
                </attribute-data-source>
                <additional-attributes-to-include>webauthn_device_count</additional-attributes-to-include>
                <attributes-location>action-attributes</attributes-location>
              </data-source-transformer>
            </authentication-action>
            <authentication-action>
              <id>selector</id>
              <selector xmlns="https://curity.se/ns/ext-conf/selector">
                <attribute-name>authmethod</attribute-name>
                <option>
                  <title>Webauthn</title>
                  <string-attribute-value>webauthn</string-attribute-value>
                </option>
                <option>
                  <title>Password</title>
                  <string-attribute-value>password</string-attribute-value>
                </option>
                <title>Select Authentication Method</title>
              </selector>
            </authentication-action>
            <authentication-action>
              <id>selector-sequence</id>
              <sequence xmlns="https://curity.se/ns/ext-conf/sequence">
                <action>selector</action>
                <action>set-authmethod-flags</action>
                <action>set-auth-method</action>
              </sequence>
            </authentication-action>
            <authentication-action>
              <id>set-auth-method</id>
              <switch xmlns="https://curity.se/ns/ext-conf/switch">
                <case>
                  <name>webauthn</name>
                  <condition-script>YXR0cmlidXRlcy5hY3Rpb24ud2ViYXV0aG4=</condition-script>
                  <action>webauthn-condition</action>
                </case>
                <case>
                  <name>password</name>
                  <condition-script>YXR0cmlidXRlcy5hY3Rpb24uaHRtbGZvcm0=</condition-script>
                  <action>htmlform-condition</action>
                </case>
              </switch>
            </authentication-action>
            <authentication-action>
              <id>set-authmethod-flags</id>
              <script-transformer xmlns="https://curity.se/ns/ext-conf/script-transformer">
                <attributes-location>action-attributes</attributes-location>
                <transformation-procedure>set-authmethod-flags-proc</transformation-procedure>
              </script-transformer>
            </authentication-action>
            <authentication-action>
              <id>set-webauthn-from-device-count</id>
              <script-transformer xmlns="https://curity.se/ns/ext-conf/script-transformer">
                <attributes-location>action-attributes</attributes-location>
                <transformation-procedure>set-webauthn-flag-proc</transformation-procedure>
              </script-transformer>
            </authentication-action>
            <authentication-action>
              <id>webauthn-condition</id>
              <multi-factor-condition xmlns="https://curity.se/ns/ext-conf/multi-factor-condition">
                <attribute-enable-condition>
                  <second-factor>
                    <id>webauthn</id>
                  </second-factor>
                  <attribute-name>webauthn</attribute-name>
                  <attribute-source>action-attributes</attribute-source>
                </attribute-enable-condition>
              </multi-factor-condition>
            </authentication-action>
          </authentication-actions>
          <authenticators>
            <authenticator>
              <id>htmlform</id>
              <account-domain>local-domain</account-domain>
              <html-form xmlns="https://curity.se/ns/conf/authenticators/html-form">
                <account-manager>default-account-manager</account-manager>
                <credential-manager>default-credential-manager</credential-manager>
                <password-only>false</password-only>
              </html-form>
            </authenticator>
            <authenticator>
              <id>username</id>
              <required-authenticator-for-registration>htmlform</required-authenticator-for-registration>
              <authentication-actions>
                <login>load_webauthn_devices</login>
                <login>set-webauthn-from-device-count</login>
                <login>check-show-selector</login>
              </authentication-actions>
              <account-domain>local-domain</account-domain>
              <username xmlns="https://curity.se/ns/ext-conf/username">
              </username>
            </authenticator>
            <authenticator>
              <id>webauthn</id>
              <account-domain>webauthn-domain</account-domain>
              <required-authenticator-for-registration>htmlform</required-authenticator-for-registration>
              <webauthn xmlns="https://curity.se/ns/conf/authenticators/webauthn">
                <allow-registration-during-login>true</allow-registration-during-login>
                <account-manager>
                  <id>default-account-manager</id>
                </account-manager>
                <ask-to-register-additional-platform-device>false</ask-to-register-additional-platform-device>
              </webauthn>
            </authenticator>
          </authenticators>
          <protocols>
            <protocol>
              <id>default-simple-protocol</id>
              <simple-api/>
            </protocol>
          </protocols>
        </authentication-service>
      </settings>
      <endpoints>
        <endpoint>
          <id>authentication-service-anonymous</id>
          <uri>/authn/anonymous</uri>
          <endpoint-kind>auth-anonymous</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-authentication</id>
          <uri>/authn/authentication</uri>
          <endpoint-kind>auth-authentication</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-registration</id>
          <uri>/authn/registration</uri>
          <endpoint-kind>auth-registration</endpoint-kind>
        </endpoint>
      </endpoints>
      <token-issuers>
        <default-token-issuer>
          <jwt-issuer-settings>
            <signing-key-id>default-signing-key</signing-key-id>
          </jwt-issuer-settings>
          <default-data-source>default-datasource</default-data-source>
        </default-token-issuer>
      </token-issuers>
    </profile>
    <profile>
      <id>token-service</id>
      <type xmlns:as="https://curity.se/ns/conf/profile/oauth">as:oauth-service</type>
      <expose-detailed-error-messages/>
      <settings>
        <authorization-server xmlns="https://curity.se/ns/conf/profile/oauth">
          <client-store>
            <config-backed>
              <client>
                <id>demo-web-client</id>
                <client-name>demo-web-client</client-name>
                <secret>$5$mUxe2gSXncUL5eLC$iS3hEmwGqFVl//ruK5Nvcd1L/shWW8SWkjmeIVujZ77</secret>
                <redirect-uris>https://oauth.tools/callback/code</redirect-uris>
                <scope>openid</scope>
                <user-authentication>
                  <allowed-authenticators>username</allowed-authenticators>
                </user-authentication>
                <allowed-origins>https://oauth.tools</allowed-origins>
                <capabilities>
                  <code>
                  </code>
                  <introspection/>
                </capabilities>
                <use-pairwise-subject-identifiers>
                  <sector-identifier>default</sector-identifier>
                </use-pairwise-subject-identifiers>
                <validate-port-on-loopback-interfaces>true</validate-port-on-loopback-interfaces>
              </client>
            </config-backed>
          </client-store>
        </authorization-server>
      </settings>
    </profile>
  </profiles>
</data>
